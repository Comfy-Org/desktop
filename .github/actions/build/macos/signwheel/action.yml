name: Sign Wheels
description: Unpack Sign Wheels and then RePack
runs:
  using: composite
  steps:
    - name: Unpack
      shell: sh
      run: |
        cd ./assets/python/wheels
        find . -name '*.whl' -exec sh -c 'unzip -d "${1%.*}" "$1"' _ {} \;
        find . -name "*.whl" -type f -delete
    - name: Install Bash
      shell: sh
      run: |
        brew install bash
        which bash
    - name: Gather
      shell: /opt/homebrew/bin/bash {0}
      run: |
        cd ./assets/python/wheels
        mapfile -t bin_array < <(find . -name "*so" -o -name "*.dylib")
        declare -p bin_array
        for i in bin_array; do codesign --sign 6698D856280DC1662A8E01E5B63428CB6D6651BB --force --timestamp --options runtime --entitlements ../../entitlements.mac.plist "$i" ; done
    - name: Sign
      shell: sh
      run: |
        echo d
    - name: Repack
      shell: sh
      run: |
        for i in */; do zip -r "${i%/}.whl" "$i"; done
