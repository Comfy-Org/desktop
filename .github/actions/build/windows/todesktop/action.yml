name: Windows Build to ToDesktop
description: Will build the project then send the project files to ToDesktop to be compiled into installers.
inputs:
  GITHUB_TOKEN:
    description: 'GitHub Token'
    required: true
  TODESKTOP_EMAIL:
    description: 'ToDesktop Email'
    required: true
  TODESKTOP_ACCESS_TOKEN:
    description: 'ToDesktop Access Token'
    required: true
runs:
  using: composite
  steps:
    - name: Use Node.js 20.x
      uses: JP250552/setup-node@feature/corepack
      with:
        node-version: '20.x'
        corepack: true
    - run: |
        mkdir -p ./todesktop-cli
        cd ./todesktop-cli
        npm init -y
        npm install @todesktop/cli@1.10.1
        cd ..
        yarn install --immutable
        yarn set version --yarn-path self
        yarn run vite:compile
      shell: bash
    - name: Make app
      shell: bash
      env:
        PUBLISH: true
        GITHUB_TOKEN: ${{ inputs.GITHUB_TOKEN }}
        TODESKTOP_EMAIL: ${{ inputs.TODESKTOP_EMAIL}}
        TODESKTOP_ACCESS_TOKEN: ${{inputs.TODESKTOP_ACCESS_TOKEN}}
      run: |
        ./todesktop-cli/node_modules/.bin/todesktop build --config ./todesktop.json --async
